#By Unknow
module FileRTPTest
  
  @readini = Win32API.new 'kernel32', 'GetPrivateProfileStringA', %w(p p p p l p), 'l'
  @@game_dll = "RGSS103J.dll"#nil
  @rtp_paths = nil
  
  def self.game_dll
    if @@game_dll.nil?
      @@game_dll = "\0" * 256
      @readini.call('Game', 'Library', '', @@game_dll, 255, ".\\Game.ini")
      @@game_dll.delete!("\0")
    end
    return @@game_dll
  end
  
  def self.rtp_paths
    if @rtp_paths.nil?
      rgssgpwrtp = Win32API.new(self.game_dll, "RGSSGetPathWithRTP", 'l', 'p')
      getrtppath = Win32API.new(self.game_dll, "RGSSGetRTPPath", 'l', 'l')
      @rtp_paths = []
      for i in 1..3
        @rtp_paths.push(rgssgpwrtp.call(getrtppath.call(i)))
      end
    end
    return @rtp_paths
  end
  
  def self.exist?(filename)
    return true if FileTest.exist?(filename)
    for path in self.rtp_paths
      next if path == ""
      if FileTest.exist?(path + filename)
        return true
      end
    end
    return false
  end
  
  def self.no_ext_exist?(filename)
    dir = File.dirname(filename)
    filebase = File.basename(filename, ".*")
    entries = Dir.entries(dir)
    for file in entries
      next if file == "."
      next if file == ".."
      if File.basename(file, ".*") == filebase
        return [true, (dir + "/" + file).gsub("\\", "/")]
      end
    end
    return [false, ""]
  end
  
end